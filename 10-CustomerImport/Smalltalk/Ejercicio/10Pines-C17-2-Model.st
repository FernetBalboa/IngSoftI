Object subclass: #Address	instanceVariableNames: 'id streetName streetNumber town zipCode province'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Address methodsFor: 'as yet unclassified' stamp: 'HernanWilkinson 11/1/2016 10:06'!isAt: aStreetName	^streetName = aStreetName ! !!Address methodsFor: 'zip code' stamp: 'HernanWilkinson 10/28/2016 16:13'!zipCode	^zipCode! !!Address methodsFor: 'zip code' stamp: 'HernanWilkinson 10/28/2016 16:08'!zipCode: aZipCode 	zipCode := aZipCode! !!Address methodsFor: 'province' stamp: 'HernanWilkinson 10/28/2016 16:08'!province: aProvince 	province := aProvince	! !!Address methodsFor: 'province' stamp: 'HernanWilkinson 10/28/2016 16:11'!province	^province! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 13:27'!streetName: aStreetName 	streetName := aStreetName ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetNumber	^streetNumber ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 13:27'!streetNumber: aStreetNumber 	streetNumber := aStreetNumber ! !!Address methodsFor: 'street' stamp: 'HernanWilkinson 10/28/2016 16:12'!streetName	^streetName ! !!Address methodsFor: 'twon' stamp: 'HernanWilkinson 10/28/2016 16:07'!town: aTown 	town := aTown! !!Address methodsFor: 'twon' stamp: 'HernanWilkinson 10/28/2016 16:12'!town	^town! !TestCase subclass: #CustomerImportTest	instanceVariableNames: 'importer system'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!CustomerImportTest methodsFor: 'test data - address' stamp: 'HernanWilkinson 11/1/2016 15:59'!addressWithoutCustomerTestData		^ ReadStream on: 'A,San Martin,3322,Olivos,1636,BsAs'! !!CustomerImportTest methodsFor: 'test data - address' stamp: 'HernanWilkinson 11/2/2016 10:45'!addressRecordStartingWithMoreThanOneATestData		^ ReadStream on: self alwaysImportedCustomerRecord,'AA,San Martin,3322,Olivos,1636,BsAs'! !!CustomerImportTest methodsFor: 'test data - address' stamp: 'HernanWilkinson 11/2/2016 10:45'!addressRecordWithMoreThanSixFieldsTestData		^ ReadStream on: self alwaysImportedCustomerRecord,'A,San Martin,3322,Olivos,1636,BsAs,y otra cosa'! !!CustomerImportTest methodsFor: 'test data - address' stamp: 'HernanWilkinson 11/2/2016 10:45'!addressRecordWithLessThanSixFieldsTestData		^ ReadStream on: self alwaysImportedCustomerRecord,'A,San Martin,3322,Olivos,1636'! !!CustomerImportTest methodsFor: 'importing' stamp: 'CookieMonster 11/19/2017 02:49'!importCustomersFrom: inputStream	(CustomerImporter from: inputStream on: system) import! !!CustomerImportTest methodsFor: 'test data' stamp: 'HernanWilkinson 11/2/2016 10:46'!validTestData	^ ReadStream on: self alwaysImportedCustomerRecord,'A,San Martin,3322,Olivos,1636,BsAsA,Maipu,888,Florida,1122,Buenos AiresC,Juan,Perez,C,23-25666777-9A,Alem,1122,CABA,1001,CABA'! !!CustomerImportTest methodsFor: 'test data' stamp: 'HernanWilkinson 11/2/2016 15:52'!dataWithEmptyLine		^ ReadStream on: self alwaysImportedCustomerRecord,'A,San Martin,3322,Olivos,1636,BsAs'! !!CustomerImportTest methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:12'!setUp	system := Environment current createCustomerSystem.	system start.	system beginTransaction! !!CustomerImportTest methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!tearDown	system commit.	system stop! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testCanNotImportAddressRecordWithMoreThanSixFields	self 		should: [ self importCustomersFrom: self addressRecordWithMoreThanSixFieldsTestData. self fail. ]		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anError | 			self assert: anError messageText equals: CustomerImporter invalidAddressRecordErrorDescription.			self assert: self alwaysImportedCustomer addressesIsEmpty ]	! !!CustomerImportTest methodsFor: 'testing' stamp: 'HernanWilkinson 11/1/2016 15:56'!testImportCustomers	self importCustomersFrom: self validTestData.	self assertImportedCustomersSizeIsCorrect.	self assertPepeSanchezWasImportedCorrectly.	self assertJuanPerezWasImportedCorrectly! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testCanNotImportCustomerRecordWithLessThanFiveFields	self		should: [ self				importCustomersFrom: self customerRecordWithLessThanFiveFieldsTestData. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self				assert: anError messageText				equals: CustomerImporter invalidCustomerRecordErrorDescription.			self assert: system isCustomersEmpty ]! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testEmptyLinesAreRecognizedAsInvalidRecords		self		should: [ self importCustomersFrom: self dataWithEmptyLine. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self assert: anError messageText equals: CustomerImporter invalidRecordTypeErrorDescription.			self assert: self alwaysImportedCustomer addressesIsEmpty ]! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testShouldNotImportCustomerRecordsStartingWithMoreThanC	self		should: [ self				importCustomersFrom: self customerRecordStartingWithMoreThanOneCTestData. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self				assert: anError messageText				equals: CustomerImporter invalidRecordTypeErrorDescription.			self assert: system isCustomersEmpty ]! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testShouldNotImportAddressRecordsStartingWithMoreThanA	self 		should: [ self importCustomersFrom: self addressRecordStartingWithMoreThanOneATestData. self fail. ]		raise: Error - MessageNotUnderstood 		withExceptionDo: [ :anError | 			self assert: anError messageText equals: CustomerImporter invalidRecordTypeErrorDescription.			self assert: self alwaysImportedCustomer addressesIsEmpty ]	! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:36'!testCanNotImportAddressRecordWithLessThanSixFields		self		should: [ self importCustomersFrom: self addressRecordWithLessThanSixFieldsTestData. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self assert: anError messageText equals: CustomerImporter invalidAddressRecordErrorDescription.			self assert: self alwaysImportedCustomer addressesIsEmpty ]! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testCanNotImportAddressWithoutCustomer	self		should: [ self importCustomersFrom: self addressWithoutCustomerTestData. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self				assert: anError messageText				equals: CustomerImporter addressWithoutCustomerErrorDescription.			self assert: system isCustomersEmpty ]! !!CustomerImportTest methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 16:35'!testCanNotImportCustomerRecordWithMoreThanFiveFields	self		should: [ self				importCustomersFrom: self customerRecordWithMoreThanFiveFieldsTestData. self fail. ]		raise: Error - MessageNotUnderstood		withExceptionDo: [ :anError | 			self				assert: anError messageText				equals: CustomerImporter invalidCustomerRecordErrorDescription.			self assert: system isCustomersEmpty ]! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/2/2016 10:47'!alwaysImportedCustomerRecord	^ 'C,Pepe,Sanchez,', self alwaysImportedCustomerIdType, ',', self alwaysImportedCustomerIdNumber ! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/2/2016 10:50'!customerRecordWithLessThanFiveFieldsTestData		^ ReadStream on: 'C,Pepe,Sanchez,D'! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/1/2016 17:48'!customerRecordStartingWithMoreThanOneCTestData		^ ReadStream on:'CC,Pepe,Sanchez,D,22333444'! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/2/2016 10:53'!customerRecordWithMoreThanFiveFieldsTestData		^ ReadStream on: self alwaysImportedCustomerRecord,',x'! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/2/2016 10:47'!alwaysImportedCustomerIdNumber	^ '22333444'! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'CookieMonster 11/18/2017 20:40'!alwaysImportedCustomer	^ system		customerIdentifiedAs: self alwaysImportedCustomerIdType		numbered: self alwaysImportedCustomerIdNumber		ifNone: [ self fail ]! !!CustomerImportTest methodsFor: 'test data - customer' stamp: 'HernanWilkinson 11/2/2016 10:46'!alwaysImportedCustomerIdType	^ 'D'! !!CustomerImportTest methodsFor: 'asserting' stamp: 'CookieMonster 11/18/2017 20:39'!assertJuanPerezWasImportedCorrectly	| customer idType idNumber |	idType := 'C'.	idNumber := '23-25666777-9'.	customer := system 		customerIdentifiedAs: idType		numbered: idNumber		ifNone: [ self fail ].	self		assert: customer		isNamed: 'Juan'		lastName: 'Perez'		identfiedAs: idType		withNumber: idNumber		andNumberOfAddresses: 1.	self		assert: customer		hasAddressAt: 'Alem'		number: 1122		in: 'CABA'		zipCode: 1001		province: 'CABA'! !!CustomerImportTest methodsFor: 'asserting' stamp: 'HernanWilkinson 11/1/2016 10:56'!assert: customer isNamed: firstName lastName: lastName identfiedAs: idType withNumber: idNumber andNumberOfAddresses: addressesSize	self assert: customer firstName equals: firstName.	self assert: customer lastName equals: lastName.	self assert: customer identificationType equals: idType.	self assert: customer identificationNumber equals: idNumber.	self assert: customer numberOfAddresses equals: addressesSize .! !!CustomerImportTest methodsFor: 'asserting' stamp: 'HernanWilkinson 11/1/2016 11:00'!assert: customer hasAddressAt: streetName number: streetNumber in: town zipCode: zipCode province: province	| address |		address := customer addressAt: streetName ifNone: [ self fail ].	self assert: address streetName equals: streetName.	self assert: address streetNumber equals: streetNumber.	self assert: address town equals: town.	self assert: address zipCode equals: zipCode.	self assert: address province equals: province.	! !!CustomerImportTest methodsFor: 'asserting' stamp: 'FernandoBalboa 11/20/2017 19:05'!assertImportedCustomersSizeIsCorrect	self assert: system allCustomersSize equals: 2! !!CustomerImportTest methodsFor: 'asserting' stamp: 'CookieMonster 11/18/2017 20:39'!assertPepeSanchezWasImportedCorrectly	| customer idType idNumber |	idType := 'D'.	idNumber := '22333444'.	customer := system 		customerIdentifiedAs: idType		numbered: idNumber		ifNone: [ self fail ].	self		assert: customer		isNamed: 'Pepe'		lastName: 'Sanchez'		identfiedAs: idType		withNumber: idNumber		andNumberOfAddresses: 2.	self		assert: customer		hasAddressAt: 'San Martin'		number: 3322		in: 'Olivos'		zipCode: 1636		province: 'BsAs'.	self		assert: customer		hasAddressAt: 'Maipu'		number: 888		in: 'Florida'		zipCode: 1122		province: 'Buenos Aires'! !Object subclass: #CustomerSystem	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!CustomerSystem methodsFor: 'importing - private - customer' stamp: 'CookieMonster 11/19/2017 03:22'!addCustomer: aCustomer
	self subclassResponsibility! !!CustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:02'!commit
	self subclassResponsibility! !!CustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/19/2017 03:00'!initializeSession
	self subclassResponsibility! !!CustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!start
	self subclassResponsibility! !!CustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/19/2017 03:00'!beginTransaction
	self subclassResponsibility! !!CustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!stop	self subclassResponsibility ! !!CustomerSystem methodsFor: 'customers' stamp: 'FernandoBalboa 11/20/2017 19:07'!isCustomersEmpty
	self subclassResponsibility! !!CustomerSystem methodsFor: 'importing' stamp: 'CookieMonster 11/19/2017 03:14'!customerIdentifiedAs: anIdentifycationType numbered: anIdentificationNumber ifNone: aClosure
	self subclassResponsibility ! !!CustomerSystem methodsFor: 'asserting' stamp: 'CookieMonster 11/19/2017 03:00'!allCustomers
	self subclassResponsibility! !!CustomerSystem methodsFor: 'asserting' stamp: 'FernandoBalboa 11/20/2017 19:05'!allCustomersSize
	self subclassResponsibility! !Object subclass: #Environment	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Environment methodsFor: 'customer system creation' stamp: 'FernandoBalboa 11/20/2017 19:17'!createCustomerSystem	self subclassResponsibility.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Environment class	instanceVariableNames: ''!!Environment class methodsFor: 'accessing' stamp: 'FernandoBalboa 11/20/2017 19:14'!current	^self allSubclasses 		detect: [ :anEnvironmentClass | anEnvironmentClass isCurrent ]		ifFound: [ :anEnvironmentClass | anEnvironmentClass new ]		ifNone: [ self error: 'No environment found' ]! !!Environment class methodsFor: 'accessing' stamp: 'FernandoBalboa 11/20/2017 19:21'!isCurrent	self subclassResponsibility.! !Environment subclass: #DevelopmentEnvironment	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!DevelopmentEnvironment methodsFor: 'customer system creation' stamp: 'FernandoBalboa 11/20/2017 19:18'!createCustomerSystem	^ TransientCustomerSystem new.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!DevelopmentEnvironment class	instanceVariableNames: ''!!DevelopmentEnvironment class methodsFor: 'testing' stamp: 'FernandoBalboa 11/21/2017 19:19'!isCurrent	^true.! !Object subclass: #Identification	instanceVariableNames: 'type number'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Identification methodsFor: 'accessing' stamp: 'FernandoBalboa 11/20/2017 19:40'!number	^ number! !!Identification methodsFor: 'accessing' stamp: 'FernandoBalboa 11/20/2017 19:40'!type	^ type! !!Identification methodsFor: 'comparison' stamp: 'FernandoBalboa 11/20/2017 19:45'!= anObject	^ (anObject class = self class)		ifTrue: [ ^(anObject number = self number and: [ anObject type = self type ]) ]		ifFalse: [ ^false ].! !!Identification methodsFor: 'initialization' stamp: 'FernandoBalboa 11/20/2017 19:48'!initializeWithType: anIdentificationType andNumber: anIdentificationNumber	type := anIdentificationType.	number := anIdentificationNumber.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Identification class	instanceVariableNames: ''!!Identification class methodsFor: 'instance creation' stamp: 'FernandoBalboa 11/21/2017 16:57'!type: anIdentificationType number: anIdentificationNumber	^self basicNew initializeWithType: anIdentificationType andNumber: anIdentificationNumber.! !Environment subclass: #IntegrationEnvironment	instanceVariableNames: ''	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!IntegrationEnvironment methodsFor: 'customer system creation' stamp: 'FernandoBalboa 11/20/2017 19:18'!createCustomerSystem	^ PersistentCustomerSystem new.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!IntegrationEnvironment class	instanceVariableNames: ''!!IntegrationEnvironment class methodsFor: 'testing' stamp: 'FernandoBalboa 11/20/2017 19:16'!isCurrent	^ DevelopmentEnvironment isCurrent not.! !Object subclass: #Party	instanceVariableNames: 'id addresses identification'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Party methodsFor: 'initialization' stamp: 'FernandoBalboa 11/21/2017 19:22'!initialize	addresses := OrderedCollection new.! !!Party methodsFor: 'as yet unclassified' stamp: 'FernandoBalboa 11/21/2017 19:17'!addressAt: aStreetName ifNone: noneClosure 		^addresses detect: [ :anAddress | anAddress isAt: aStreetName ] ifNone: noneClosure ! !!Party methodsFor: 'as yet unclassified' stamp: 'FernandoBalboa 11/21/2017 19:18'!addressesIsEmpty		^addresses isEmpty! !!Party methodsFor: 'identification' stamp: 'FernandoBalboa 11/21/2017 19:18'!identificationType		^identification type ! !!Party methodsFor: 'identification' stamp: 'FernandoBalboa 11/21/2017 19:18'!identificationNumber		^identification number.! !!Party methodsFor: 'addresses' stamp: 'FernandoBalboa 11/21/2017 19:18'!numberOfAddresses		^addresses size! !!Party methodsFor: 'addresses' stamp: 'FernandoBalboa 11/21/2017 19:16'!addAddress: anAddress 	addresses add: anAddress ! !!Party methodsFor: 'addresses' stamp: 'FernandoBalboa 11/21/2017 19:16'!addresses
	self subclassResponsibility! !Party subclass: #Customer	instanceVariableNames: 'firstName lastName'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!firstName		^firstName ! !!Customer methodsFor: 'name' stamp: 'HernanWilkinson 10/28/2016 16:15'!lastName	^lastName ! !!Customer methodsFor: 'initialization' stamp: 'FernandoBalboa 11/21/2017 19:22'!initializeWithFirstName: aCustomersFirstName lastName: aCustomersLastName identification: aCustomersIdentification.	super initialize.	firstName := aCustomersFirstName.	lastName := aCustomersLastName.	identification := aCustomersIdentification.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Customer class	instanceVariableNames: ''!!Customer class methodsFor: 'accessing' stamp: 'FernandoBalboa 11/21/2017 18:04'!firstName: aCustomersFirstName lastName: aCustomersLastName identification: aCustomersIdentification	^self new	 		initializeWithFirstName: aCustomersFirstName			lastName: aCustomersLastName			identification: aCustomersIdentification.! !Object subclass: #PartyImporter	instanceVariableNames: 'line readStream record system'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!PartyImporter methodsFor: 'initialization' stamp: 'FernandoBalboa 11/21/2017 16:41'!initializeOn: aReadStream on: aSystem	readStream := aReadStream.	system := aSystem.! !!PartyImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 16:39'!convertLineToRecord	record := line substrings: {$,}.		self assertRecordNotEmpty! !!PartyImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 16:40'!canImportNextLine	line := readStream nextLine.	^ line notNil! !!PartyImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 16:41'!assertRecordNotEmpty		record isEmpty ifTrue: [ self signalInvalidRecordType ]! !!PartyImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 16:21'!importRecord
	self subclassResponsibility! !!PartyImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 16:21'!importAddress
	self subclassResponsibility! !!PartyImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 16:38'!isAddressRecord	^ record first = 'A'! !!PartyImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 16:45'!createAddressFromRecord	| newAddress |	newAddress := Address new.	newAddress streetName: record second.	newAddress streetNumber: record third asInteger.	newAddress town: record fourth.	newAddress zipCode: record fifth asInteger.	newAddress province: record sixth.	^ newAddress! !!PartyImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 16:41'!assertValidAddressRecordSize		record size ~= 6 ifTrue: [ self signalInvalidAddressRecord ].	! !!PartyImporter methodsFor: 'importing' stamp: 'FernandoBalboa 11/21/2017 16:41'!import	[ self canImportNextLine ] whileTrue: [ 		self convertLineToRecord.		self importRecord ]! !!PartyImporter methodsFor: 'error signal' stamp: 'FernandoBalboa 11/21/2017 16:31'!signalInvalidRecordType
	self error: self class invalidRecordTypeErrorDescription! !!PartyImporter methodsFor: 'error signal' stamp: 'FernandoBalboa 11/21/2017 16:31'!signalInvalidAddressRecord
	self error: self class invalidAddressRecordErrorDescription ! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!PartyImporter class	instanceVariableNames: ''!!PartyImporter class methodsFor: 'instance creation' stamp: 'FernandoBalboa 11/21/2017 16:33'!from: aReadStream on: aSystem
	^self new initializeOn: aReadStream on: aSystem! !!PartyImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 16:33'!invalidAddressRecordErrorDescription
	^'Invalid address record'! !!PartyImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 16:33'!invalidRecordTypeErrorDescription
	^'Invalid record type'! !PartyImporter subclass: #CustomerImporter	instanceVariableNames: 'newCustomer'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!CustomerImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 16:30'!importRecord		self isCustomerRecord ifTrue: [ ^self importCustomer ].	self isAddressRecord ifTrue: [ ^self importAddress ].		self signalInvalidRecordType! !!CustomerImporter methodsFor: 'error signal' stamp: 'HernanWilkinson 11/2/2016 10:52'!signalInvalidCustomerRecord 		self error: self class invalidCustomerRecordErrorDescription ! !!CustomerImporter methodsFor: 'error signal' stamp: 'HernanWilkinson 11/1/2016 16:01'!signalAddressWithoutCustomerError	self error: self class addressWithoutCustomerErrorDescription.! !!CustomerImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 19:24'!importAddress	| newAddress |	self assertThereIsCustomerForAddress.	self assertValidAddressRecordSize.	newAddress := self createAddressFromRecord.	^ newCustomer addAddress: newAddress! !!CustomerImporter methodsFor: 'importing - private - address' stamp: 'FernandoBalboa 11/21/2017 19:24'!assertThereIsCustomerForAddress	newCustomer isNil ifTrue: [ self signalAddressWithoutCustomerError ].	! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'FernandoBalboa 11/21/2017 18:09'!recordedFirstName	^ record second! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'FernandoBalboa 11/21/2017 18:11'!importCustomer	self assertValidCustomerRecordSize.	newCustomer := Customer		firstName: self recordedFirstName		lastName: self recordedLastName		identification: self recordedIdentification.	system addCustomer: newCustomer.! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'FernandoBalboa 11/21/2017 18:10'!recordedLastName	^ record third! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'FernandoBalboa 11/21/2017 16:47'!assertValidCustomerRecordSize		record size ~= 5 ifTrue: [ self signalInvalidCustomerRecord ].	! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'FernandoBalboa 11/21/2017 18:10'!recordedIdentification	^Identification type: record fourth number: record fifth.! !!CustomerImporter methodsFor: 'importing - private - customer' stamp: 'HernanWilkinson 11/2/2016 10:55'!isCustomerRecord	^ record first = 'C'! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CustomerImporter class	instanceVariableNames: ''!!CustomerImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 19:47'!invalidCustomerRecordErrorDescription		^'Error: Invalid customer record'! !!CustomerImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 19:47'!addressWithoutCustomerErrorDescription		^'Error: There is no customer for the imported address'! !CustomerSystem subclass: #PersistentCustomerSystem	instanceVariableNames: 'session'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!PersistentCustomerSystem methodsFor: 'customers' stamp: 'FernandoBalboa 11/20/2017 19:08'!isCustomersEmpty	^ (session selectAllOfType: Customer) isEmpty! !!PersistentCustomerSystem methodsFor: 'asserting' stamp: 'FernandoBalboa 11/20/2017 19:08'!allCustomersSize	^ (session selectAllOfType: Customer) size! !!PersistentCustomerSystem methodsFor: 'importing' stamp: 'CookieMonster 11/18/2017 20:38'!customerIdentifiedAs: anIdentifycationType numbered: anIdentificationNumber ifNone: aClosure	| customers |	customers := session		select: [ :aCustomer | 			aCustomer identificationType = anIdentifycationType				and: [ aCustomer identificationNumber = anIdentificationNumber ] ]		ofType: Customer.	customers size = 1		ifTrue: [ ^ customers anyOne ]		ifFalse: aClosure.	^ self! !!PersistentCustomerSystem methodsFor: 'importing - private - customer' stamp: 'CookieMonster 11/19/2017 03:11'!addCustomer: aCustomer	session persist: aCustomer! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:02'!commit	session commit! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/18/2017 20:43'!initializeSession	session := (DataBaseSession				for: (Array with: self addressMapping with: self customerMapping))! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!start	session open! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/18/2017 19:54'!addressMapping	^ ClassMapping		withDefaultTableNameFor: Address		mappingAll:			(Array				with: (EmbededMapping withDefaultFieldNameFor: #streetName)				with: (EmbededMapping withDefaultFieldNameFor: #streetNumber)				with: (EmbededMapping withDefaultFieldNameFor: #town)				with: (EmbededMapping withDefaultFieldNameFor: #zipCode)				with: (EmbededMapping withDefaultFieldNameFor: #province))! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/18/2017 20:42'!beginTransaction	session beginTransaction! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!stop	session close! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/18/2017 20:10'!initialize	self initializeSession! !!PersistentCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/21/2017 19:05'!customerMapping	^ ClassMapping		withDefaultTableNameFor: Customer		mappingAll:			(Array				with: (EmbededMapping withDefaultFieldNameFor: #firstName)				with: (EmbededMapping withDefaultFieldNameFor: #lastName)				with: (EmbededMapping withDefaultFieldNameFor: #identification)				with: (OneToManyMapping withDefaultFieldNameFor: #addresses ofType: Address))! !Party subclass: #Supplier	instanceVariableNames: 'name customers'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!Supplier methodsFor: 'initialization' stamp: 'FernandoBalboa 11/21/2017 19:26'!initializeWithName: aSuppliersName identification: aSuppliersIdentification.	super initialize.	name := aSuppliersName.	identification := aSuppliersIdentification.	customers := OrderedCollection new.! !!Supplier methodsFor: 'customer addition' stamp: 'FernandoBalboa 11/21/2017 19:23'!addCustomer: aCustomer	customers add: aCustomer.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Supplier class	instanceVariableNames: ''!!Supplier class methodsFor: 'instance creation' stamp: 'FernandoBalboa 11/21/2017 19:55'!name: aSupplierName identification: aSupplierIdentification	^self new initializeWithName: aSupplierName identification: aSupplierIdentification. ! !PartyImporter subclass: #SupplierImporter	instanceVariableNames: 'newSupplier'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 19:50'!signalInvalidSupplierRecord		self error: self class invalidSupplierRecordErrorDescription.! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 19:46'!assertThereIsSupplierForAddress	newSupplier isNil ifTrue: [ self signalAddressWithoutSupplierError ]! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 20:03'!signalInvalidExistingCustomerRecord		self error: self class invalidExistingCustomerRecordErrorDescription.! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 20:04'!assertValidNewCustomerRecordSize		record size ~= 5 ifTrue: [ self signalInvalidNewCustomerRecord ].! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 20:04'!signalInvalidNewCustomerRecord		self error: self class invalidNewCustomerRecordErrorDescription.! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 19:47'!signalAddressWithoutSupplierError	self error: self class addressWithoutSupplierErrorDescription.! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 19:49'!assertValidSupplierRecordSize		record size ~= 4 ifTrue: [ self signalInvalidSupplierRecord ].! !!SupplierImporter methodsFor: 'asserting' stamp: 'FernandoBalboa 11/21/2017 20:07'!assertValidExistingCustomerRecordSize		record size ~= 3 ifTrue: [ self signalInvalidExistingCustomerRecord ].! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:40'!recordedName	^record second.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:32'!isNewCustomerRecord	^ record first = 'NC'.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 20:06'!importExistingCustomer		self assertThereIsSupplierForAddress.	self assertValidExistingCustomerRecordSize.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:58'!importSupplier	self assertValidSupplierRecordSize.	newSupplier := Supplier name: self recordedName identification: self recordedIdentification.	system addSupplier: newSupplier.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:43'!recordedIdentification	^Identification type: (record third) number: (record fourth).! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:53'!importAddress	| newAddress |	self assertThereIsSupplierForAddress.	self assertValidAddressRecordSize.	newAddress := self createAddressFromRecord.	^ newSupplier addAddress: newAddress! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:32'!isExistingCustomerRecord	^ record first = 'EC'.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 20:06'!importNewCustomer	self assertThereIsSupplierForAddress.	self assertValidNewCustomerRecordSize.	! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:31'!importRecord	self isSupplierRecord ifTrue: [ self importSupplier. ].	self isNewCustomerRecord ifTrue: [ self importNewCustomer. ].	self isExistingCustomerRecord ifTrue: [ self importExistingCustomer. ].	self isAddressRecord ifTrue: [ self importAddress ].		self signalInvalidRecordType.! !!SupplierImporter methodsFor: 'importing - private' stamp: 'FernandoBalboa 11/21/2017 19:32'!isSupplierRecord	^ record first = 'S'.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!SupplierImporter class	instanceVariableNames: ''!!SupplierImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 19:48'!addressWithoutSupplierErrorDescription	^'Error: There is no supplier for the imported address.'! !!SupplierImporter class methodsFor: 'error descriptions' stamp: 'FernandoBalboa 11/21/2017 19:50'!invalidSupplierRecordErrorDescription	^'Error: Invalid supplier record.'! !CustomerSystem subclass: #TransientCustomerSystem	instanceVariableNames: 'customers'	classVariableNames: ''	poolDictionaries: ''	category: '10Pines-C17-2-Model'!!TransientCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:02'!commit! !!TransientCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!start	customers := OrderedCollection new.! !!TransientCustomerSystem methodsFor: 'setup-teardown' stamp: 'CookieMonster 11/19/2017 03:05'!beginTransaction! !!TransientCustomerSystem methodsFor: 'setup-teardown' stamp: 'FernandoBalboa 11/20/2017 19:03'!stop! !!TransientCustomerSystem methodsFor: 'importing' stamp: 'CookieMonster 11/19/2017 03:19'!customerIdentifiedAs: anIdentifycationType numbered: anIdentificationNumber ifNone: aClosure	| selectedCustomers |	selectedCustomers := customers select: [ :aCustomer | 			aCustomer identificationType = anIdentifycationType				and: [ aCustomer identificationNumber = anIdentificationNumber ] ].	selectedCustomers size = 1		ifTrue: [ ^ selectedCustomers anyOne ]		ifFalse: aClosure.	^ self! !!TransientCustomerSystem methodsFor: 'customers' stamp: 'FernandoBalboa 11/20/2017 19:07'!isCustomersEmpty	^ customers isEmpty    ! !!TransientCustomerSystem methodsFor: 'asserting' stamp: 'FernandoBalboa 11/20/2017 19:05'!allCustomersSize	^customers size ! !!TransientCustomerSystem methodsFor: 'adding' stamp: 'CookieMonster 11/19/2017 03:13'!addCustomer: aCustomer	customers add: aCustomer ! !